name: Prescription WorkFlow

on: push
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Create Network
        run: docker network create inside
      - name: Build the stack
        run: docker-compose up -d
      - name: Docker ps
        run: docker ps
      - name: Composer install
        run: docker exec prescriptions-api composer install --no-interaction --prefer-dist --optimize-autoloader
      - name: Copy .env
        run: docker exec prescriptions-api php -r "file_exists('.env') || copy('.env.example', '.env');"
      - name: Generate key
        run: docker exec prescriptions-api php artisan key:generate
      - name: Execute Migration
        run: docker exec prescriptions-api php artisan migrate
      - name: execute test
        run: docker exec prescriptions-api vendor/bin/phpunit